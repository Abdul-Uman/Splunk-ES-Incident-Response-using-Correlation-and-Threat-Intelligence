## Introduction

This repository documents the process of using **Splunk Enterprise Security (ES)** to create and manage security incidents, with a focus on **large numbers of Windows login failure attempts from the same user**.

The guide includes steps for **creating correlation searches, responding to alerts, and managing incidents using ServiceNow Ticketing Tool and email communications**.

## Creating a Correlation Search in Splunk ES

### Large Number of Windows Login Failure Attempts

**Description**: This section covers the steps to create a correlation search in Splunk ES for detecting a large number of Windows login failure attempts from the same user.

1. **Access Splunk ES**: Open your Splunk ES environment.  
3. **Navigate to Content Management**: Go to the **Configure** menu, Choose **Content** then select **Content Management**.


![Screenshot 2024-08-23 190401](https://github.com/user-attachments/assets/806d2184-1c3d-49d3-9cd3-2bd27f131906)


  
5. **Create New Correlation Search**:
   - Select **New Content** and choose **Correlation Search**.


![Screenshot 2024-08-23 185247](https://github.com/user-attachments/assets/81fd7ec9-0c0a-436e-992b-32b0d86519dd)



   - Configure the search to detect multiple login failures from the **same user**.
   - Write the **SPL query** to define the conditions for the alert.


![Screenshot 2024-08-23 192812](https://github.com/user-attachments/assets/5c4a7a4b-1ac8-4034-af68-73bf504d2345)


   - Configure **Schedule Time and Priority**


![Screenshot 2024-08-23 192913](https://github.com/user-attachments/assets/e079628c-62e5-48f9-9ab1-426d30e78c19)


   - Configure **Throttling** to supress our next alert from user


![Screenshot 2024-08-23 192943](https://github.com/user-attachments/assets/da43cc87-8cbe-4dae-9dea-350ce053d77f)


   - Set up a **Notable Event** to be triggered when the conditions are met.


![Screenshot 2024-08-23 192953](https://github.com/user-attachments/assets/b426513d-f46d-4ec5-b043-7ba930ca4b8f)

 
   - Configure **Drill down Name and Search** to check matching events from user(we can also collect historical Events from here)


![Screenshot 2024-08-23 193214](https://github.com/user-attachments/assets/513fd338-1a7d-4180-afcd-01ee447d36e4)

  
5. **Save and Deploy**: Save the correlation search and ensure itâ€™s deployed.


![Screenshot 2024-08-23 193251](https://github.com/user-attachments/assets/916c5bf4-c60b-4afa-b57a-15f953e5a881)



## Incident Response Workflow

### Identifying and Responding to Alerts

**Description**: This section outlines the process for identifying alerts generated by the correlation search and responding to them in Splunk ES.

1. **Monitor Incident Review**: Alerts based on the correlation search will appear in the **Incident Review** dashboard.


![Screenshot 2024-08-23 221242](https://github.com/user-attachments/assets/d7cac535-b34d-4d23-b723-55402e7884bb)

   
2. **Contributing Events**: For each alert, Collect Matching Event Data


![Screenshot 2024-08-23 222606](https://github.com/user-attachments/assets/d3b3c45d-af61-4051-9d06-0b02ce34bc50)


3. Download **Matching Events** as a **CSV file** for further analysis.


![Screenshot 2024-08-23 223841](https://github.com/user-attachments/assets/d0904288-c60b-4b15-ac72-08016ae65a8f)


4. Create it in a manner **Readable and Easy to Understand**


![Screenshot 2024-08-23 225658](https://github.com/user-attachments/assets/6a778b74-f2f9-4f1d-ac43-23ac8fefde65)



### Communication and Ticketing

**Description**: This section covers the steps to communicate with relevant teams and manage incidents using ServiceNow.


1. **Create a Ticket in ServiceNow**: Document the incident by creating a ticket in the ServiceNow platform.

   - Select **Start Building** 


![Screenshot 2024-08-23 232153](https://github.com/user-attachments/assets/7db0cc02-aed7-4c90-8845-1d45210dae5a)


   - Navigate to **All**
   - Select **Incindents**

![Screenshot 2024-08-23 232258](https://github.com/user-attachments/assets/52fc6bbe-7dab-408e-a08b-649583d4ac3c)

    
  - Fill the **Information about Incident with Attachment of Downloaded CSV file**

 
![Screenshot 2024-08-23 232822](https://github.com/user-attachments/assets/471f14cc-c422-435c-9362-02c0ccdd9219)

 
3. **Email Communication**: Send an email to the respective team which conatins all information about Incident, asking them to verify whether the Incident is a true positive or false positive.


![Screenshot 2024-08-23 233604](https://github.com/user-attachments/assets/8b0b7692-b762-4988-a6d3-b9e9d0e967d5)

   

### Determining True or False Positive

**Description**: This section provides guidance on analyzing the team's response to determine whether the event is a true or false positive.

1. **False Positive Scenario**:
   - If the team confirms the event was caused by a benign script or cookie (e.g., a background process with outdated credentials), classify the incident as a false positive.
   - Close the incident after documenting the findings.

2. **True Positive Scenario**:
   - If the team confirms that the user did not perform the actions, suspect a potential compromise.
   - Initiate further investigation and containment procedures.


### Remediation Steps

**Description**: This section outlines the actions to take in the event of a confirmed true positive, focusing on minimizing the cost of impact and remediation.

1. **Isolate the System**: Disconnect the compromised device from the network to prevent further unauthorized access.
2. **Log Review**: Analyze logs from firewalls, proxy servers, and email gateways to identify the attack vector and scope.
3. **Install Malwarebytes and Scan the System**:
   - Run a full system scan using Malwarebytes to detect any malicious software or activity.
   - If suspicious activity is found, delete the malicious files and recover the system.
   - If nothing is found or if the system remains compromised, proceed to reimage the system.
4. **Remediate the System**: If no clear evidence of malicious activity is found, or if the malware removal process fails, reimage the system to restore it to a secure state.
5. **Minimize Impact**: Ensure that the cost of impact and remediation is kept to a minimum while fully addressing the threat.

